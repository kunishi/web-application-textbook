# クライアントサイドアプリケーション

- 実行の仕組み
    - JSインタプリタをブラウザが内包
    - JSソースコードをサーバからダウンロードし、逐次実行
    - FlashやJavaアプレットでも仕組みはほぼ同じ
- 特異性
    - イベント駆動
    - サーバからダウンロードされたときに実行されるのは関数などの定義だけ
    - なんらかのイベントが発生したときに初めて関数を実行
        - ユーザがメニューをマウスで押したら詳細項目を表示、など
    - 主な構成
        - GUI構成部品(DOMの一節点であることが多い)
        - 部品で発生するイベント
        - イベントが発生したときに行う処理
 
## 例
メニュー項目にマウスを当てるとサブメニューが表示、外すとサブメニューが消える

### HTML

``` html
<ul id=“menu”>
  <li>メニュー1
    <ul>
      <li>サブメニュー1</li>
      <li>サブメニュー2</li>
    </ul>
  </li>
  …
</ul>
```

### JS

``` javascript
$(document).ready(function() {
  $(‘#menu li’).hover(
    function() { $(this).children(‘ul’).show(); },
    function() { $(this).children(‘ul’).hide(); }
  );
});
```

- 注意
  - サーバ上にあるHTMLファイルが書き換えられるわけではない
  - ブラウザが内包するDOMに対してのみ操作が行われる
  - ブラウザを閉じたら変更内容は破棄される
- Ajax
    - JSインタプリタから外部のサーバにHTTPリクエストを出す
        - 例: some.phpにPOSTリクエストを出し、結果をブラウザのalertダイアログで出す

``` javascript
jQuery.ajax({
  type: “POST”,
  url: “some.php”,
  success: function(msg) {
    alert(msg);
  }
});
```

- スレッド
  - シングルスレッド、マルチスレッド
  - ブラウザはシングルスレッド
  - 描画を行っている間、ユーザからの操作など、他の処理は受け付けない(待たされる)
  - 外部にHTTPリクエストを投げると、その応答が返ってくるまでブラウザの処理がすべて止まる
  - Todo: うまい説明ができるよう考える
  - 解決策
    - 非同期処理
      - JSからHTTPリクエストをさせる際、結果を受信したときに行う処理を一緒に登録する(コールバック関数)
      - HTTPレスポンスはいつ返ってくるかわからない→コールバック関数もいつ実行されるかわからない
- クライアントサイドアプリケーションの応用
    - SPA (Single Page Application)
        - ブラウザで最初に読み込んだHTMLページのDOMをJSで変更することだけで動作するアプリケーション
        - サーバからはデータだけをAjaxで取得、画面の組み立てはクライアント側のJSですべて行う
        - JSの実行速度が上がってきたため、クライアントの少ない計算リソースでも実用的に動くようになってきた
        - 利点：ページ遷移が不要、DOMの一部だけを書き換えるため画面遷移が高速、サーバからダウンロードされるデータ量も削減→モバイル環境に向いている
        - 欠点：検索エンジンに収集されにくい、etc.
    - スマートフォンアプリの作り方
        - ネイティブアプリ
            - ソースコードをコンパイルし、スマートフォンのOS上で動作するバイナリとしてアプリを作成
            - 利点：スマートフォンの機能がフルに使える、動作が速い
            - 欠点：iOS/Androidそれぞれについて独立に作らなければならない→クロスプラットフォーム対応が難しい
        - Webアプリ
            - ブラウザ上で動作するアプリ
            - 利点：クロスプラットフォーム対応が比較的簡単
            - 欠点：スマートフォンの機能が十分に使えない（センサ機能など）、動作が遅い、ブラウザ経由でしか動作しない
        - HTML5ハイブリッドアプリ
            - アプリのコアはHTML+CSS+JS（主にSPA）で、それを（HTML+CSS+JSとOSの橋渡しをする）ネイティブアプリでくるむ
            - 利点：クロスプラットフォーム対応が比較的簡単、スマートフォンの機能が（ネイティブアプリ経由で）かなり使える、ブラウザを経由しなくても動く
            - 欠点：ネイティブアプリよりは遅い（が、ネットワークアクセスが少ない分Webアプリより高速）