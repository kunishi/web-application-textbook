# セキュリティ

- 安全確保、機密保持
- バグに起因
- 通信が絡むとデータを守るべき箇所が増える
- ユーザとしてのセキュリティ（使っているパソコン + α）→開発者としてのセキュリティ（サーバ、クライアント、通信路）

## 通信における危険性

一般に、通信におけるセキュリティ上の危険には、次の3つが考えられる。

- 盗聴：通信路を流れるデータを第三者が盗み見る
- 改ざん：通信路を流れるデータを第三者が不正に書き換える
- なりすまし：第三者が正規の通信相手に成り代わり通信を行い、不正な行為を行う

インターネットにおける通信では、これらのセキュリティ上の危険に対し、**公開鍵基盤**（Public Key Infrastructure, PKI）という公開鍵暗号方式を基礎とする解決策が広く用いられている。特にWebでは、PKIを利用したセキュアな通信方式である**TLS**(Transport Layer Security)[^1]が広く用いられる。TLSはトランスポート層(TCP, UDP)とアプリケーション層の間に置かれるプロトコルであり、Web(HTTP)だけでなく、FTP, LDAP, TELNETなどのアプリケーション層プロトコルでも利用できる。

特に、TLS上で実現されるHTTP通信プロトコルを**HTTPS**と呼ぶ。

[^1]: 以前は**SSL**(Secure Socket Layer)というアルゴリズムが使われていたが、セキュリティ上の不備がアルゴリズムに発見されたため、現在はその後継であるTLSを用いるのが普通である。ただし「PKIを用いたWebにおけるセキュアな通信」の総称として「SSL」という言葉を用いることも少なくない。

## 暗号化技術

TLSの説明をする前に、技術基盤となる暗号化について簡単に解説しておこう。

### エンコードと暗号化

データに対し、後で元に戻せるような変換を施すことを **エンコード** (符号化, encode)という。エンコードされたデータを元に戻すことを **デコード** (decode)という。ここまでに登場したMIMEエンコーディング、BASE64エンコーディング、URLエンコーディングなどはエンコードの例である。ただし、セキュリティの観点では、一般にエンコードされたデータは誰でもデコードすることができるため、セキュリティ上の危険への対策にはなっていない。

エンコードの特殊な場合として、通信の当事者間でのみ共有される秘密の情報を用いなければデコードできない、というものを考えることができる。このようなエンコードを **暗号化** (encrypt)、暗号化されたデータを復元することを **復号** (decrypt)という。また、暗号化および復号において用いられる、当事者間でのみ共有される秘密の情報を **鍵** (key)という。

### 共通鍵暗号方式

暗号化の方式で最も簡単なのは、暗号化と復号とで同じ鍵を用いる方式である。これを **共通鍵暗号方式** (symmetric key cryptography)という。共通鍵暗号方式では、通信の当事者間で同じ鍵（ **共通鍵** , symmetric key)を共有する。共通鍵暗号によるデータの暗号化・復号の概略は次のようになる。

1. あらかじめ生成された共通鍵Kを、何らかの方法で送り手と受け手とで共有しておく。
2. 送り手は、Kを用いて送信したいデータDを暗号化し（D' = encrypt（D, K))、暗号化後のデータD'を受け手に送信する。
3. 受け手は、Kを用いてD'を復号し（D = decrypt(D', K))、元のデータDを得る。

### 公開鍵暗号方式

PKIにおいて重要となるもう一つの暗号化方式が **公開鍵暗号方式** (public key cryptography)である。公開鍵暗号方式は、共通鍵暗号方式に比べ計算コストが高いが、後述するように、共通鍵暗号方式での問題点であった「鍵の共有」について解決策を与えるとともに、デジタルデータへの署名という別の用途にも解決策を与えている。

公開鍵暗号方式では **秘密鍵** (private key)と **公開鍵** (public key)という2本の鍵を用いる。これらは常に対として用いられ、かつ、次に示す重要な性質がある。

- 秘密鍵SKで暗号化されたデータは公開鍵PKでしか復号できない。(D' = encrypt(D, SK) の時 D = decrypt(D', PK))
- 公開鍵PKで暗号化されたデータは秘密鍵SKでしか復号できない。(D' = encrypt(D, PK) の時 D = decrypt(D', SK))

後述するように、TLSにおいては、秘密鍵は鍵を生成した当事者が誰にも（もちろん他の当事者にも）知られないよう厳重に保管し、一方公開鍵は誰でも（通信の当事者以外の人でも）利用できるように公開する、という使い方をする。

### 暗号学的ハッシュ関数

暗号とは異なるが、PKIにおいて重要な役割を果たす **暗号学的ハッシュ関数** (cryptographic hash function)というものを紹介しておこう。これは、任意のデータを与えると固定長のビット列を出力する関数(H = hash(D))で、かつ次のような性質を持つ。

- 入力データが異なれば、出力は必ず異なる。( D1 ≠ D2 ならば hash(D1) ≠ hash(D2)　)
- 出力結果Hから元のデータDを求めることは極めて困難（事実上不可能）である。
- 

## TLS
TODO: 講義ではかなり詳しく話しているので、それを踏まえて内容を書き足す。

- 盗聴の対策…暗号化
    - 暗号の基本的な考え方
        - アルゴリズム＋送信者・受信者で共有する秘密の情報（鍵）でデータを暗号化・復号
    - 共有鍵暗号 vs. 公開鍵暗号
        - 共有鍵暗号の致命的な欠点：共有鍵をいかに安全に共有するか
    - SSL/TLSでの方法
        - 共有鍵の受け渡しに公開鍵暗号を用いる
- 改ざんの対策…データダイジェスト
    - SHA1, MD5などのアルゴリズムでデータの数学的な要約（ダイジェスト）を作る
    - データ＋ダイジェストを送信、受信者は受け取ったデータからダイジェストを計算し、受け取ったダイジェストと比較
    - ダイジェスト関数 digest(x) の性質
        - x1 ≠ x2 なら常に digest(x1) ≠ digest(x2)
        - x1 = x2 なら常に digest(x1) = digest(x2)